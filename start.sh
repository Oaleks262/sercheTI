#!/bin/bash

# –°–∫—Ä–∏–ø—Ç –¥–ª—è –∑–∞–ø—É—Å–∫—É —Å–µ—Ä–≤–µ—Ä–∞ –∞–Ω–∞–ª—ñ—Ç–∏–∫–∏ —Ç–æ–≤–∞—Ä—ñ–≤
# –ü–æ—Ä—Ç: 1609

echo "üöÄ –ó–∞–ø—É—Å–∫ —Å–µ—Ä–≤–µ—Ä–∞ –∞–Ω–∞–ª—ñ—Ç–∏–∫–∏ —Ç–æ–≤–∞—Ä—ñ–≤..."
echo "üìä –ü–æ—Ä—Ç: 1609"
echo "üåê URL: http://localhost:1609"
echo ""

# –ü–µ—Ä–µ–≤—ñ—Ä—è—î–º–æ —á–∏ –≤—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–æ Node.js
if ! command -v node &> /dev/null
then
    echo "‚ùå Node.js –Ω–µ –≤—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–æ. –ë—É–¥—å –ª–∞—Å–∫–∞, –≤—Å—Ç–∞–Ω–æ–≤—ñ—Ç—å Node.js –≤–µ—Ä—Å—ñ—ó 14 –∞–±–æ –≤–∏—â–µ."
    exit 1
fi

# –ü–µ—Ä–µ–≤—ñ—Ä—è—î–º–æ –≤–µ—Ä—Å—ñ—é Node.js
NODE_VERSION=$(node --version | cut -d'v' -f2)
echo "‚úÖ Node.js –≤–µ—Ä—Å—ñ—è: $NODE_VERSION"

# –ü–µ—Ä–µ–≤—ñ—Ä—è—î–º–æ —á–∏ –ø–æ—Ä—Ç 1609 –≤—ñ–ª—å–Ω–∏–π
if lsof -Pi :1609 -sTCP:LISTEN -t >/dev/null ; then
    echo "‚ö†Ô∏è  –ü–æ—Ä—Ç 1609 –≤–∂–µ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î—Ç—å—Å—è!"
    echo "üîç –ü—Ä–æ—Ü–µ—Å, —â–æ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î –ø–æ—Ä—Ç:"
    lsof -Pi :1609 -sTCP:LISTEN
    echo ""
    echo "üí° –î–ª—è –∑—É–ø–∏–Ω–∫–∏ –ø—Ä–æ—Ü–µ—Å—É –≤–∏–∫–æ—Ä–∏—Å—Ç–∞–π—Ç–µ: kill -9 <PID>"
    echo "üîÑ –ê–±–æ –≤–∏–±–µ—Ä—ñ—Ç—å —ñ–Ω—à–∏–π –ø–æ—Ä—Ç —É —Ñ–∞–π–ª—ñ server.js"
    exit 1
fi

# –ó–∞–ø—É—Å–∫–∞—î–º–æ —Å–µ—Ä–≤–µ—Ä
echo "üèÉ –ó–∞–ø—É—Å–∫ —Å–µ—Ä–≤–µ—Ä–∞..."
node server.js